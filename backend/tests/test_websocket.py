from fastapi.testclient import TestClient\nimport time\n\nfrom backend.main import app\n\nclient = TestClient(app)\n\n\ndef test_websocket_connect_and_send_message():\n    # Ensure a user exists and token is returned\n    resp = client.post("/auth/register", json={"username": "charlie", "password": "pwd123"})\n    assert resp.status_code in (200, 201)\n    resp = client.post("/auth/login", params={"username": "charlie", "password": "pwd123"})\n    assert resp.status_code == 200\n    token = resp.json()["access_token"]\n\n    # Connect to WebSocket for room General (id assumed 1)\n    with client.websocket_connect("/ws/1?token=" + token) as websocket:\n        websocket.send_text("Hello from Charlie")\n        data = websocket.receive_json()\n        assert data is not None\n