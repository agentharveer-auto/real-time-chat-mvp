from fastapi import APIRouter, Depends, HTTPException, status\nfrom sqlalchemy.orm import Session\nfrom ..database import get_db\nfrom ..models import User\nfrom ..schemas import UserRead, Token, UserCreate\nfrom ..auth import get_password_hash, verify_password, create_access_token, decode_access_token, SECRET_KEY, ALGORITHM, ACCESS_TOKEN_EXPIRE_MINUTES\n\nrouter = APIRouter()\n\n\n@router.post("/register", response_model=UserRead, status_code=status.HTTP_201_CREATED)\ndef register(user: UserCreate, db: Session = Depends(get_db)):\n    existing = db.query(User).filter(User.username == user.username).first()\n    if existing:\n        raise HTTPException(status_code=400, detail="Username already registered")\n    hashed = get_password_hash(user.password)\n    new_user = User(username=user.username, hashed_password=hashed)\n    db.add(new_user)\n    db.commit()\n    db.refresh(new_user)\n    return UserRead.from_orm(new_user)\n\n\n@router.post("/login", response_model=Token)\ndef login(username: str, password: str, db: Session = Depends(get_db)):\n    user = db.query(User).filter(User.username == username).first()\n    if not user or not verify_password(password, user.hashed_password):\n        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail="Invalid credentials")\n    token = create_access_token({"sub": str(user.id) }, expires_delta=None)\n    return {"access_token": token, "token_type": "bearer"}\n